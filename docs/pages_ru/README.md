---
title: Утилита trdl
permalink: /
sidebar: none
---
## Что это
`trdl` — open source-утилита для автоматического распространения обновлений. Это универсальный менеджер пакетов, который доставляет новые версии вашей программы из доверенного TUF-репозитория.

## Преимущества
### Каналы обновления вместо версий ПО
Пользователю не нужно скачивать конкретные версии пакетов. Вместо этого он выбирает канал обновления с необходимыми уровнями совместимости и стабильности: Alfa, Beta, Stable и т. д. Через эти каналы разработчики распространяют нужные пользователю версии релизов. Частота обновлений не ограничена.

### Действительно безопасная доставка
В основе системы безопасности trdl два элемента: TUF-репозиторий для хранения релизов и плагин Vault (vault-plugin-secrets-trdl), который проверяет их аутентичность с помощью приватного ключа.

- Из преимуществ TUF: контрольные суммы и подписи у пакетов; возможность ротации ключей; защита от rollback-атак; защита от «заморозки».
- Vault можно настроить так, чтобы ни у кого не было доступа к приватному ключу, даже у администратора.
- Vault сам управляет и настраивает TUF-репозиторий: новые пакеты, темп обновлений, ротация ключей.

[Подробнее](security.html) о системе безопасности `trdl`.

### Публикация релизов на основе GPG-кворума
В trdl реализован механизм «M of N»: каждый коммит в Git подписывается несколькими разработчиками. Чтобы добавить несколько подписей на один коммит, используются обычные Git-подписи — или подписи через механизм notes.GPG. Кворум используется и для тегов (публикации версий), и для подписи trdl.json (публикации версий в канал обновления).

### Кроссплатформенность
- MacOS, Windows, Ubuntu, Red Hat и даже Gentoo.
- x86, x86-84, ARM.
- Доставка на сервер или на ноутбук разработчика.

### Простота использования

| Разработчикам | Пользователям |
|:--------------|:--------------|
| Для работы с trdl не нужны дополнительные знания и инструменты. Если ваша сборка работает в Docker, она заработает в trdl. Достаточно указать название образа и команду для build. Единственное условие: результаты сборки нужно разместить в определенной директории. [Подробнее](https://ru.trdl.flant.com/documentation/). | Одна команда, чтобы добавить источник пакетов на хост. Простые варианты: автоматического получения последней версии ПО из канала; ручного получения и активации последней версии ПО из канала; активации только в рамках текущей bash-сессии; работы с плейбуками и другой автоматизации. [Подробнее](https://ru.trdl.flant.com/documentation/). |

## Как это работает
1. Разработчик делает коммит.
2. Код проверяют тим-лид и, если нужно, другие разработчики. Они подписывают коммит дополнительными GPG-подписями.
3. Из CI-системы релиз поступает в плагин vault-plugin-secrets-trdl. Плагин проверяет, соответствуют ли GPG существующему списку разрешенных подписей.
4. Если с GPG всё в порядке, vault-plugin-secrets-trdl отправляет релиз на сборку образа.
5. Плагин генерирует электронную подпись на основе нескольких приватных ключей TUF-репозитория — root, targets, snapshot и timestamp. Ключи автоматически генерируются и ротируются. У пользователя нет прямого доступа к этим ключам.
6. Подписанный образ загружается в Объектное хранилище (TUF-репозиторий).
7. Релиз автоматически доставляется пользователю или на сервер через выбранные каналы обновления.

## Какие проблемы решает trdl
### Ограниченность пакетных менеджеров
Есть множество пакетных менеджеров, но у всех типичные недостатки:
- для каждой платформы нужен свой менеджер;
- сложно создавать пакеты;
- пользователь всё должен делать сам: добавлять источник пакетов, находить пакет, устанавливать, обновлять, удалять.

### Ограниченность continuous delivery
Непрерывная доставка через CI-систему хорошо работает с SaaS-продуктами, то есть на облачных серверах. Но трудно найти инструмент, который так же быстро доставлял бы код на пользовательские устройства.

### Сложность организации безопасной доставки
Почему это сложно:
- Одной GPG-подписи недостаточно. (Что, если взломают ноутбук разработчика?) Нужно выстроить систему приемки кода и подписи собранных бинарных файлов на основе кворума.
- Система приемки не должна зависеть от человеческих ошибок: автобусный фактор, нарушение регламентов, мисклики и пр.
- Но даже самая сложная система может не работать.
Пример. Релиз утверждают три разработчика, product owner, офицер безопасности и кто-нибудь еще. Но при этом администратор приемочной системы может поставить «галочки» за всех.

[Документация, советы, быстрый старт](https://ru.trdl.flant.com/documentation/).

[trdl на GitHub](https://github.com/werf/trdl).
