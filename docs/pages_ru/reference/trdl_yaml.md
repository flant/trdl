---
title: trdl.yaml
permalink: reference/trdl_yaml.html
toc: false
---

Конфигурация `trdl.yaml` содержит инструкции, которые определяют окружение и набор команд, необходимый для сборки артефактов релиза.

При релизе trdl читает `trdl.yaml` из Git-тега и выполняет сборку:
- Запускает контейнер на базе выбранного Docker-образа.
- Монтирует исходный код Git-тега в директорию `/git`.
- Выполняет сборочные инструкции в директории `/git`.
- Сохраняет артефакты релиза из директории `/result`.

{% include reference/trdl_yaml/table.html %}

## Организация артефактов релиза

После выполнения сборочных инструкций артефакты релиза должны быть в директории `/result`. Артефактам требуется определённая организация директорий для интеграции с trdl-клиентом, доставки на различные платформы и эффективной работы с исполняемыми файлами.

Артефакты релиза необходимо сохранять в соответствующие директории платформ, для доставки на которые они рассчитаны.
Имя директории платформы определяется операционной системой и архитектурой `<os>-<arch>`.
Если разделение на операционные системы и/или архитектуры не требуется, можно использовать зарезервированное имя `any`. Ниже — список поддерживаемых комбинаций, выстроенных по приоритету использования trdl-клиентом.

```
darwin-amd64
darwin-arm64
darwin-any
linux-amd64
linux-amd64
linux-any
windows-amd64
windows-any
any-any
```

Чтобы использовать основную функциональность trdl-клиента (к примеру, команду [trdl use](/reference/cli/trdl_use.html)), необходимо сохранять исполняемые файлы в поддиректории `bin`.

В итоге для большинства проектов справедлива следующая структура директории `/result` после сборки:
```
result
├── ...
└── <os>-<arch>
    ├── bin
    │   ├── ...
    │   └── <release artifact>
    ├── ...
    └── <release artifact>
```

Здесь:

- `os` — операционная система (`darwin`, `linux`, `windows` или `any`, если артефакты релиза не зависят от системы);
- `arch` — архитектура (`amd64`, `arm64` или `any`, если артефакты релиза не зависят от платформы);
- `release artifact` — произвольный файл.

## Пример

### trdl.yaml

{% include reference/trdl_yaml/example_trdl_yaml.md.liquid %}

### build.sh

{% include reference/trdl_yaml/example_build_sh.md.liquid %}

### Использование сборочных секретов

Вы можете использовать секреты во время сборки, предварительно добавив их в хранилище секретов с помощью метода [`/configure/build/secrets`]({{ "/reference/vault_plugin/configure/build/secrets.html" | true_relative_url }}). Секреты мотируются по пути `/run/secrets/<id>`, где `id` - это идентификатор секрета использованного при добавлении секрета в хранилище. Пример использования:

{% include reference/trdl_yaml/example_trdl_yaml_w_secrets.md.liquid %}

### Директория /result после выполнения сборочных инструкций

{% include reference/trdl_yaml/example_result.md.liquid %}
